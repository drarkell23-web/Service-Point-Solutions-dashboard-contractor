<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ServicePoint SA – Contractor Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body class="theme-dark">
  <!-- TOPBAR -->
  <header class="sp-topbar">
    <div class="sp-brand">
      <div class="sp-brand-logo">S</div>
      <div class="sp-brand-text">
        <div class="sp-brand-name">ServicePoint SA</div>
        <div class="sp-brand-sub">Contractor Live SaaS Dashboard</div>
      </div>
    </div>

    <div class="sp-topbar-center">
      <div class="sp-top-pill">
        All your ServicePoint leads, jobs & billing in one live control panel.
      </div>
      <div class="sp-top-filters">
        <label class="sp-filter">
          Range
          <select id="filterRange">
            <option value="30">Last 30 days</option>
            <option value="7">Last 7 days</option>
            <option value="90">Last 90 days</option>
            <option value="all">All time</option>
          </select>
        </label>

        <label class="sp-filter">
          Region
          <select id="filterRegion">
            <option value="all">All regions</option>
            <option value="KZN">KZN</option>
            <option value="Gauteng">Gauteng</option>
            <option value="Western Cape">Western Cape</option>
            <option value="Other">Other</option>
          </select>
        </label>
      </div>
    </div>

    <div class="sp-topbar-right">
      <button id="btnNewLeadHeader" class="primary-btn">+ New lead</button>
      <button id="themeToggle" class="ghost-btn">Theme</button>
    </div>
  </header>

  <main class="sp-main">
    <!-- OVERVIEW -->
    <section class="sp-section">
      <header class="sp-section-header">
        <div>
          <h1 class="sp-section-title">Dashboard overview</h1>
          <p class="sp-section-sub">
            Live snapshot of leads, jobs and billing – powered only by real data you or admin send in.
          </p>
        </div>
      </header>

      <div class="sp-grid-4 sp-kpis">
        <article class="sp-card sp-card-kpi">
          <div class="sp-kpi-label">New leads (filtered)</div>
          <div id="kpiLeads" class="sp-kpi-value">0</div>
          <div class="sp-kpi-foot">From ServicePoint + assistant in selected range.</div>
        </article>

        <article class="sp-card sp-card-kpi">
          <div class="sp-kpi-label">Active jobs</div>
          <div id="kpiActiveJobs" class="sp-kpi-value">0</div>
          <div class="sp-kpi-foot">Jobs not yet completed or cancelled.</div>
        </article>

        <article class="sp-card sp-card-kpi">
          <div class="sp-kpi-label">Pipeline value</div>
          <div id="kpiPipeline" class="sp-kpi-value">R0</div>
          <div class="sp-kpi-foot">Quoted, booked & in-progress work.</div>
        </article>

        <article class="sp-card sp-card-kpi">
          <div class="sp-kpi-label">Paid (filtered)</div>
          <div id="kpiPaid" class="sp-kpi-value">R0</div>
          <div class="sp-kpi-foot">Invoices marked as paid in this date range.</div>
        </article>
      </div>
    </section>

    <!-- ANALYTICS -->
    <section class="sp-section">
      <header class="sp-section-header">
        <div>
          <h2 class="sp-section-title">Analytics</h2>
          <p class="sp-section-sub">
            Trends update automatically as new leads, jobs and invoices are added.
          </p>
        </div>
      </header>

      <div class="sp-grid-main-side">
        <div class="sp-grid-main">
          <!-- Leads timeline -->
          <article class="sp-card">
            <header class="sp-panel-header">
              <div>
                <h2>Leads timeline</h2>
                <p>Day-by-day leads in the selected date range.</p>
              </div>
            </header>
            <div class="sp-chart-wrap">
              <canvas id="chartLeadsTimeline"></canvas>
              <div id="chartLeadsTimelineEmpty" class="sp-chart-empty">
                Waiting for your first lead…
              </div>
            </div>
          </article>

          <!-- Channel + status -->
          <div class="sp-grid-2 sp-mt-lg">
            <article class="sp-card">
              <header class="sp-panel-header">
                <div>
                  <h2>Lead sources</h2>
                  <p>Where your work is coming from.</p>
                </div>
              </header>
              <div class="sp-chart-wrap-small">
                <canvas id="chartChannelBreakdown"></canvas>
                <div id="chartChannelEmpty" class="sp-chart-empty small">
                  No leads yet to show channels.
                </div>
              </div>
            </article>

            <article class="sp-card">
              <header class="sp-panel-header">
                <div>
                  <h2>Status mix</h2>
                  <p>New, quoted, booked, completed and more.</p>
                </div>
              </header>
              <div class="sp-chart-wrap-small">
                <canvas id="chartStatusBreakdown"></canvas>
                <div id="chartStatusEmpty" class="sp-chart-empty small">
                  No leads yet to show statuses.
                </div>
              </div>
            </article>
          </div>
        </div>

        <!-- Activity + today -->
        <aside class="sp-grid-side">
          <article class="sp-card sp-card-activity">
            <header class="sp-panel-header">
              <div>
                <h2>Live activity</h2>
                <p>Everything that happens in your account.</p>
              </div>
            </header>
            <ul id="activityFeed" class="sp-activity-list"></ul>
            <div id="activityEmpty" class="sp-activity-empty">
              No activity yet. As soon as a lead, job or invoice is created, it will show here.
            </div>
          </article>

          <article class="sp-card sp-card-mini sp-mt-sm">
            <header class="sp-panel-header">
              <h2>Today’s snapshot</h2>
              <p>Only items that fall on today’s date.</p>
            </header>
            <dl class="sp-mini-metrics">
              <div>
                <dt>Leads today</dt>
                <dd id="miniLeadsToday">0</dd>
              </div>
              <div>
                <dt>Jobs on site today</dt>
                <dd id="miniJobsToday">0</dd>
              </div>
              <div>
                <dt>Value of work today</dt>
                <dd id="miniValueToday">R0</dd>
              </div>
            </dl>
          </article>
        </aside>
      </div>
    </section>

    <!-- LEADS -->
    <section class="sp-section">
      <header class="sp-section-header">
        <div>
          <h2 class="sp-section-title">Leads & clients</h2>
          <p class="sp-section-sub">
            Every lead from ServicePoint SA, WhatsApp, phone calls or manual capture.
          </p>
        </div>
        <button id="btnNewLeadLeadsView" class="primary-btn">+ New lead</button>
      </header>

      <div class="sp-card sp-mt-sm">
        <div class="sp-leads-toolbar">
          <div class="sp-leads-filters">
            <input
              id="leadsSearch"
              class="sp-input"
              placeholder="Search by client, service or channel…"
            />
            <select id="leadsStatusFilter" class="sp-input">
              <option value="all">All statuses</option>
              <option value="New">New</option>
              <option value="Contacted">Contacted</option>
              <option value="Quoted">Quoted</option>
              <option value="Booked">Booked</option>
              <option value="In progress">In progress</option>
              <option value="Completed">Completed</option>
              <option value="Lost">Lost</option>
            </select>
            <select id="leadsChannelFilter" class="sp-input">
              <option value="all">All channels</option>
              <option value="ServicePoint SA">ServicePoint SA</option>
              <option value="WhatsApp">WhatsApp</option>
              <option value="Phone">Phone</option>
              <option value="Email">Email</option>
              <option value="Walk-in">Walk-in</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <span class="sp-leads-count">
            <span id="leadsCount">0</span> lead(s)
          </span>
        </div>

        <table class="sp-table sp-table-leads">
          <thead>
            <tr>
              <th>Date</th>
              <th>Client</th>
              <th>Service</th>
              <th>Channel</th>
              <th>Region</th>
              <th>Status</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody id="leadsTableBody"></tbody>
        </table>
        <div id="leadsEmptyState" class="sp-table-empty">
          No leads yet. When admin pushes your first lead, it will appear here.
        </div>
      </div>
    </section>

    <!-- JOBS -->
    <section class="sp-section">
      <header class="sp-section-header">
        <div>
          <h2 class="sp-section-title">Jobs & schedule</h2>
          <p class="sp-section-sub">
            Jobs created from your leads or manually. Use it as your simple site board.
          </p>
        </div>
        <button id="btnNewJob" class="primary-btn">+ New job</button>
      </header>

      <div class="sp-card sp-mt-sm">
        <table class="sp-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Job</th>
              <th>Client</th>
              <th>Location</th>
              <th>Status</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody id="jobsTableBody"></tbody>
        </table>
        <div id="jobsEmptyState" class="sp-table-empty">
          No jobs yet. Convert a lead into a job or create one manually.
        </div>
      </div>
    </section>

    <!-- BILLING -->
    <section class="sp-section">
      <header class="sp-section-header">
        <div>
          <h2 class="sp-section-title">Billing & invoices</h2>
          <p class="sp-section-sub">
            Keep a quick log next to your full accounting system.
          </p>
        </div>
        <button id="btnNewInvoice" class="primary-btn">+ New invoice</button>
      </header>

      <div class="sp-grid-3 sp-mt-sm">
        <article class="sp-card sp-card-kpi">
          <div class="sp-kpi-label">Invoiced (filtered)</div>
          <div id="billInvoiced" class="sp-kpi-value">R0</div>
          <div class="sp-kpi-foot">All invoices in the selected date range.</div>
        </article>

        <article class="sp-card sp-card-kpi">
          <div class="sp-kpi-label">Paid</div>
          <div id="billPaid" class="sp-kpi-value">R0</div>
          <div class="sp-kpi-foot">Invoices marked as paid.</div>
        </article>

        <article class="sp-card sp-card-kpi">
          <div class="sp-kpi-label">Outstanding</div>
          <div id="billOutstanding" class="sp-kpi-value">R0</div>
          <div class="sp-kpi-foot">Invoiced minus paid.</div>
        </article>
      </div>

      <div class="sp-card sp-mt-lg">
        <table class="sp-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Invoice #</th>
              <th>Client</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="invoicesTableBody"></tbody>
        </table>
        <div id="invoicesEmptyState" class="sp-table-empty">
          No invoices yet. Add them as you bill clients.
        </div>
      </div>
    </section>

    <!-- SETTINGS / API HOOKS -->
    <section class="sp-section">
      <header class="sp-section-header">
        <div>
          <h2 class="sp-section-title">Settings & API hooks</h2>
          <p class="sp-section-sub">
            Front-end only. Later you can wire this into Supabase or any backend.
          </p>
        </div>
      </header>

      <div class="sp-settings-grid">
        <article class="sp-card sp-settings-block">
          <h2>Notification toggles</h2>
          <label class="sp-toggle">
            <input type="checkbox" checked />
            <span></span>
            Email me when a new lead arrives
          </label>
          <label class="sp-toggle">
            <input type="checkbox" checked />
            <span></span>
            Email me when a job is booked
          </label>
          <label class="sp-toggle">
            <input type="checkbox" />
            <span></span>
            Email me when an invoice is overdue
          </label>
        </article>

        <article class="sp-card sp-settings-block">
          <h2>Connected channels</h2>
          <ul class="sp-settings-list">
            <li>
              <span>ServicePoint SA</span>
              <span class="sp-tag sp-tag-live">Connected</span>
            </li>
            <li>
              <span>WhatsApp assistant</span>
              <span class="sp-tag sp-tag-live">Connected</span>
            </li>
            <li>
              <span>Manual capture</span>
              <span class="sp-tag">Always available</span>
            </li>
          </ul>
        </article>

        <article class="sp-card sp-settings-block">
          <h2>API hooks (front-end only)</h2>
          <p class="sp-settings-note">
            Admin or another site can push directly into this dashboard using:
          </p>
          <pre class="sp-code">
window.addServicePointLead({...})
window.addServicePointJob({...})
window.addServicePointInvoice({...})</pre>
          <p class="sp-settings-note small">
            Later you can connect these to Supabase REST, webhooks or your own Node server.
          </p>
        </article>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="sp-footer">
    <span>© 2025 ServicePoint SA · Contractor HQ</span>
    <span>Live data only – everything here is driven by real leads and jobs.</span>
  </footer>

  <!-- MODALS -->

  <!-- NEW LEAD MODAL -->
  <div id="leadModal" class="sp-modal-bg">
    <div class="sp-modal">
      <header class="sp-modal-header">
        <h2>New lead</h2>
        <button class="sp-modal-close" data-modal-close="leadModal">✕</button>
      </header>
      <p class="sp-modal-sub">
        Quick capture from ServicePoint, WhatsApp, phone or walk-in.
      </p>

      <form id="leadForm" class="sp-form">
        <label class="sp-field">
          <span>Client name</span>
          <input id="leadClient" type="text" class="sp-input" required />
        </label>

        <label class="sp-field">
          <span>Service requested</span>
          <input
            id="leadService"
            type="text"
            class="sp-input"
            placeholder="e.g. Geyser replacement – Pinetown"
            required
          />
        </label>

        <div class="sp-form-grid-3">
          <label class="sp-field">
            <span>Channel</span>
            <select id="leadChannel" class="sp-input">
              <option value="ServicePoint SA">ServicePoint SA</option>
              <option value="WhatsApp">WhatsApp</option>
              <option value="Phone">Phone</option>
              <option value="Email">Email</option>
              <option value="Walk-in">Walk-in</option>
              <option value="Other">Other</option>
            </select>
          </label>

          <label class="sp-field">
            <span>Region</span>
            <select id="leadRegion" class="sp-input">
              <option value="KZN">KZN</option>
              <option value="Gauteng">Gauteng</option>
              <option value="Western Cape">Western Cape</option>
              <option value="Other">Other / Unassigned</option>
            </select>
          </label>

          <label class="sp-field">
            <span>Status</span>
            <select id="leadStatus" class="sp-input">
              <option value="New">New</option>
              <option value="Contacted">Contacted</option>
              <option value="Quoted">Quoted</option>
              <option value="Booked">Booked</option>
              <option value="In progress">In progress</option>
              <option value="Completed">Completed</option>
              <option value="Lost">Lost</option>
            </select>
          </label>
        </div>

        <label class="sp-field">
          <span>Estimated value (R)</span>
          <input
            id="leadValue"
            type="number"
            min="0"
            step="1"
            class="sp-input"
            placeholder="e.g. 2500"
          />
        </label>

        <div class="sp-modal-actions">
          <button
            type="button"
            class="ghost-btn"
            data-modal-close="leadModal"
          >
            Cancel
          </button>
          <button type="submit" class="primary-btn">Save lead</button>
        </div>
      </form>
    </div>
  </div>

  <!-- NEW JOB MODAL -->
  <div id="jobModal" class="sp-modal-bg">
    <div class="sp-modal">
      <header class="sp-modal-header">
        <h2>New job</h2>
        <button class="sp-modal-close" data-modal-close="jobModal">✕</button>
      </header>
      <p class="sp-modal-sub">
        Create a job from a confirmed client or lead.
      </p>

      <form id="jobForm" class="sp-form">
        <div class="sp-form-grid-2">
          <label class="sp-field">
            <span>Date</span>
            <input id="jobDate" type="date" class="sp-input" required />
          </label>
          <label class="sp-field">
            <span>Client name</span>
            <input id="jobClient" type="text" class="sp-input" required />
          </label>
        </div>

        <label class="sp-field">
          <span>Job description</span>
          <input
            id="jobTitle"
            type="text"
            class="sp-input"
            placeholder="e.g. Geyser replacement – Pinetown"
            required
          />
        </label>

        <div class="sp-form-grid-3">
          <label class="sp-field">
            <span>Location</span>
            <input
              id="jobLocation"
              type="text"
              class="sp-input"
              placeholder="e.g. Pinetown"
            />
          </label>
          <label class="sp-field">
            <span>Status</span>
            <select id="jobStatus" class="sp-input">
              <option value="Booked">Booked</option>
              <option value="On site">On site</option>
              <option value="In progress">In progress</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </label>
          <label class="sp-field">
            <span>Job value (R)</span>
            <input
              id="jobValue"
              type="number"
              min="0"
              step="1"
              class="sp-input"
            />
          </label>
        </div>

        <div class="sp-modal-actions">
          <button
            type="button"
            class="ghost-btn"
            data-modal-close="jobModal"
          >
            Cancel
          </button>
          <button type="submit" class="primary-btn">Save job</button>
        </div>
      </form>
    </div>
  </div>

  <!-- NEW INVOICE MODAL -->
  <div id="invoiceModal" class="sp-modal-bg">
    <div class="sp-modal">
      <header class="sp-modal-header">
        <h2>New invoice</h2>
        <button class="sp-modal-close" data-modal-close="invoiceModal">✕</button>
      </header>
      <p class="sp-modal-sub">
        Track invoices here while you use your main accounting system.
      </p>

      <form id="invoiceForm" class="sp-form">
        <div class="sp-form-grid-3">
          <label class="sp-field">
            <span>Date</span>
            <input id="invoiceDate" type="date" class="sp-input" required />
          </label>
          <label class="sp-field">
            <span>Invoice #</span>
            <input id="invoiceNumber" type="text" class="sp-input" required />
          </label>
          <label class="sp-field">
            <span>Client</span>
            <input id="invoiceClient" type="text" class="sp-input" required />
          </label>
        </div>

        <div class="sp-form-grid-2">
          <label class="sp-field">
            <span>Amount (R)</span>
            <input
              id="invoiceAmount"
              type="number"
              min="0"
              step="1"
              class="sp-input"
              required
            />
          </label>
          <label class="sp-field">
            <span>Status</span>
            <select id="invoiceStatus" class="sp-input">
              <option value="Sent">Sent</option>
              <option value="Paid">Paid</option>
              <option value="Overdue">Overdue</option>
            </select>
          </label>
        </div>

        <div class="sp-modal-actions">
          <button
            type="button"
            class="ghost-btn"
            data-modal-close="invoiceModal"
          >
            Cancel
          </button>
          <button type="submit" class="primary-btn">Save invoice</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js" defer></script>
</body>
</html>
